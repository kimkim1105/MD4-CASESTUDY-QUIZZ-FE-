<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
          integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
            crossorigin="anonymous"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</head>
<body>
<li class="nav-item active">
    <a class="nav-link" onclick="showAddForm()">Thêm Mới <span class="sr-only">(current)</span></a>
</li>

<div class="form-inline my-2 my-lg-0">
    <input class="form-control mr-sm-2" type="text" placeholder="Search" id="search" >
    <button class="btn btn-outline-success my-2 my-sm-0"  onclick="findAllQuestionsByCategory()">Search</button>
</div>
<div id="long"></div>
<div>
    <table class="table" id="display"></table>
</div>
<script>
    let show = document.getElementById("long");
    function display(data) {
        let str = ` <tr>
        <th scope="col">name</th>
        <th scope="col">action</th>
    </tr>`
        for (let i = 0; i < data.length; i++) {
            str += `   <tr>
                        <td>${data[i].name}</td>
                        <td><button class="button1" onclick="deleteSt(${data[i].id})">delete</button></td>
                    </tr>`
        }
        document.getElementById('display').innerHTML = str;
    }

    function save() {
        let name = document.getElementById("name").value;
        let category = {
            "name": name
        }
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
            },
            type: 'POST',
            url: 'http://localhost:8080/categories',
            data: JSON.stringify(category),
            success: function (data) {
                fillAll()
            },
            error: function (error) {
                console.log(error)
            }
        })
    }
    function fillAll() {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/categories",
            success: function (data) {
                display(data)
            }, error: function (error) {
                console.log(error);
            }
        })
    }

    function showAddForm() {
        let str = `<form id="form">
    <input type="text" name="name" id="name">
    <button type="button" onclick="save()">save</button>
</form>`
        show.innerHTML = str;
    }

    fillAll()

    function deleteSt(id) {

        $.ajax({
            type: 'DELETE',
            url: 'http://localhost:8080/categories/' + id,
            success: function (data) {
                fillAll(data)
            }
        })
    }
    function findAllQuestionsByCategory(id) {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/categories/"+id+"/questions",
            success: function (data) {
                display(data)
            }, error: function (error) {
                console.log(error);
            }
        })
    }
</script>
</body>
</html>